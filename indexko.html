<html>
	<head>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.0/jquery.min.js"></script>
		<script src="js/knockout.2.0.0.js"></script> 
		<script src="js/sammy.js"></script> 
		
		<link rel="stylesheet" type="text/css" href="css/main.css" />
		<link rel="stylesheet" type="text/css" href="css/nav.css"/> 
	</head>
<body>
	<hr>
	<h2>debug</h2>
	MenuItem: <span data-bind = "text:selectedMenuItem"></span> 
	<br>
	MenuData: <span data-bind="text: ko.toJSON(selectedMenuData)"></span>
	<br>
	template: <span data-bind="text:templateToUse()"></span>
	<hr>
	
	<!-- Menu -->
	<ul class="menu" data-bind="foreach: menuItems">
    	<li data-bind="text: $data,
                   css: { selected: $data == $root.selectedMenuItem() },
                   click: $root.goToScreen"></li>
	</ul>
	
	
	
	<div data-bind="template: { name: templateToUse, foreach: selectedMenuData }"></div>
	
	<script id="Home" type="text/html">
		<h2>HOME SCREEN</h2><div data-bind="text: name"></div> 
	</script> 
	
	<script id="Teams" type="text/html">
    	<div data-bind="text: name"></div>    
	</script>
	
	<script id="Players" type="text/html">
    	<div data-bind="text: firstName"></div>    
	</script>
	
	<script id="Conferences" type="text/html">
    	<div data-bind="text: name"></div>    
	</script>
	
	<script type="text/javascript">

	function FBViewModel () {
		//Data
		var self = this; 
		//self.menuItems = [new menuItem('Teams','teams.json'), new menuItem('Players','players.json'), new menuItem('Conferences','conferences.json')];
		self.menuItems = ['Teams','Players','Conferences'];
		self.selectedMenuItem = ko.observable("Home"); 
		self.selectedMenuData = ko.observableArray(); 
		
		//template switching
		self.templateToUse = function() {return self.selectedMenuItem()}.bind(FBViewModel); 
		
		//Behaviors
		//hide other templates?
		self.goToScreen = function (menuItem) { location.hash = menuItem; }; 

		// Client-side routes
		Sammy(function (context) {
			this.get('#:menuItem', function () {
				//only do this for things i know how to handle
				//if (!(self.menuItems.contains(this.params.menuItem)))
				//{
				//	return false; 
				//}
				self.selectedMenuData(null); 
				var selectedItem = this.params.menuItem; 
				//get file name
				var dataFile = selectedItem.toLowerCase() + '.json';  
				console.log(dataFile); 
				
				//todo - cache these
				$.ajax({
          				url: 'data/' + dataFile,
          				dataType: 'json',
          				success: function(items) {
							//alert ("updating menu item to " + selectedItem); 
							self.selectedMenuItem(selectedItem);
							
							//alert ("updating menu data") ; 
							//set the view & data //todo - switch view when caching. error handle. 
							self.selectedMenuData(items); 
         			 }
        		});
				//$.get("/mail", { folder: this.params.folder }, self.selectedFolderData);
			});
			
			this.get('#:menuItem/:itemId', function () {
				self.selectedMenuItem(this.params.menuItem);
				self.selectedMenuData(null);
				//$.get("/mail", { mailId: this.params.mailId }, self.selectedMailData);
			});
			
			//home screen
			//this.get('', function () { this.app.runRoute('get', '#Inbox') });
			
		}).run(); 
		
	}
	var model = new FBViewModel;
	ko.applyBindings(model); 
	
	Array.prototype.contains = function (itemId){
	for (index in this) {  //todo check speed
		if (this[index].name === itemId)
		{
			return true; 
		}
	}
	return false; 
	};
	</script> 	
	

</body>
</html>